<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Jupytext Web Converter (GitHub Pages)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ブラウザだけで動くJupytextコンバータ - .ipynb, .py, .mdを相互変換" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📓</text></svg>">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Prism CSS for Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

  <!-- External CSS -->
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!-- GitHub Ribbon -->
  <a href="https://github.com/Sunwood-ai-labs/Jupytext-Web" class="github-corner" aria-label="View source on GitHub" target="_blank">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0; z-index: 1000;" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
  </a>

  <div class="ambient">
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    <div class="glow glow-3"></div>
  </div>

  <div class="app-shell">
    <!-- Language Switcher -->
    <div class="language-switcher">
      <button id="lang-ja" class="lang-btn active" aria-label="日本語">🇯🇵 日本語</button>
      <button id="lang-en" class="lang-btn" aria-label="English">🇺🇸 English</button>
    </div>

    <!-- Hero -->
    <header class="hero">
      <div class="hero-meta">
        <span class="tag beta">Web · Pyodide</span>
        <span class="tag format">ipynb ⇆ py ⇆ md</span>
      </div>
      <h1>📓 Jupytext Web Converter</h1>
      <p class="subtitle">
        ブラウザだけで動く Jupytext コンバータ（GitHub Pages 対応）。<br />
        <code>.ipynb</code>, <code>.py</code>, <code>.md</code> などを滑らかに往復変換します。
      </p>
      <div class="hero-highlights">
        <div class="highlight">
          <span>⚡</span>
          <small>Pyodide 上でネイティブに動作</small>
        </div>
        <div class="highlight">
          <span>🪄</span>
          <small>ドラッグ＆ドロップですぐ変換</small>
        </div>
        <div class="highlight">
          <span>🔐</span>
          <small>ローカルのみで完結・安全</small>
        </div>
      </div>
    </header>

    <main class="panel-grid">
      <!-- Controls Panel -->
      <section class="panel panel-primary">
        <h2>入力方法を選択</h2>
        <p class="panel-lead">ファイルまたはテキストから変換できます。</p>

        <!-- Input Mode Tabs -->
        <div class="input-mode-tabs">
          <button id="tab-file" class="tab-button active" data-mode="file">📁 ファイルアップロード</button>
          <button id="tab-text" class="tab-button" data-mode="text">📝 テキスト入力</button>
        </div>

        <!-- File Upload Section -->
        <div id="file-upload-section" class="input-section active">
          <div class="field">
            <label for="file">📁 入力ファイル</label>
            <div class="file-upload-wrapper">
              <div id="file-drop-zone" class="file-drop-zone">
                <div class="upload-icon">📤</div>
                <div class="upload-text">ファイルをドラッグ＆ドロップ</div>
                <div class="upload-hint">または クリックしてファイルを選択</div>
              </div>
              <input id="file" type="file" accept=".ipynb,.py,.md,.Rmd" />
            </div>

            <!-- File Info Display -->
            <div id="file-info" class="file-info">
              <div class="file-info-content">
                <div class="file-details">
                  <span class="file-icon">📄</span>
                  <div>
                    <div id="file-name" class="file-name"></div>
                    <div id="file-size" class="file-size"></div>
                  </div>
                </div>
                <button id="remove-file" class="remove-file">✕ 削除</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Text Input Section -->
        <div id="text-input-section" class="input-section">
          <div class="field">
            <label for="text-input">📝 テキストを入力</label>
            <div class="text-input-wrapper">
              <div id="text-input" class="text-input-area"></div>
              <div class="text-input-info">
                <span id="text-char-count" class="text-char-count">0 文字</span>
                <button id="clear-text" class="clear-text-btn">✕ クリア</button>
              </div>
            </div>
          </div>

          <div class="field">
            <label for="text-input-format">📋 入力フォーマット</label>
            <select id="text-input-format">
              <option value="ipynb">📓 ipynb (Jupyter Notebook)</option>
              <option value="py">🐍 py (Python)</option>
              <option value="md" selected>📝 md (Markdown)</option>
              <option value="myst">📝 myst (MyST Markdown)</option>
            </select>
          </div>
        </div>

        <!-- Format Selection -->
        <div class="field">
          <label for="to-format">🔄 変換先フォーマット</label>
          <select id="to-format">
            <option value="ipynb">📓 ipynb (Jupyter Notebook)</option>
            <option value="py:percent">🐍 py:percent (Python with %% cells)</option>
            <option value="py:light">🐍 py:light (Python light format)</option>
            <option value="md">📝 md (Markdown)</option>
            <option value="myst">📝 myst (MyST Markdown)</option>
          </select>
        </div>

        <!-- Timestamp Option -->
        <div class="field">
          <label for="add-timestamp" style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="add-timestamp" checked style="margin-right: 8px;">
            <span>🕐 ファイル名にタイムスタンプを追加</span>
          </label>
        </div>

        <!-- Convert Button -->
        <div class="button-wrapper">
          <button id="convert" disabled>⏳ Pyodide 読み込み中...</button>
        </div>

        <!-- Progress Bar -->
        <div id="progress-container" class="progress-container">
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
        </div>

        <!-- Status Message -->
        <div id="status" class="status"></div>
      </section>

      <!-- Preview Panel -->
      <section class="panel panel-preview">
        <div class="panel-head">
          <div>
            <p class="eyebrow">ライブプレビュー</p>
            <h2>変換結果を即チェック</h2>
          </div>
          <button id="copy-btn" class="copy-button">📋 コピー</button>
        </div>
        <div id="preview" class="preview">
          <div id="preview-content" class="preview-content"></div>
        </div>
        <div class="preview-placeholder" id="preview-placeholder">
          <p>ここに変換結果が表示されます。</p>
          <span>ファイルをアップロードして開始しましょう。</span>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div>
        <p class="footer-text">Powered by Pyodide × Jupytext</p>
        <small class="footer-subtext">データはすべてブラウザ内で完結します。</small>
      </div>
      <div class="footer-links">
        <a href="https://pyodide.org/" target="_blank" class="footer-link">Pyodide</a>
        <a href="https://jupytext.readthedocs.io/" target="_blank" class="footer-link">Jupytext</a>
        <a href="https://github.com/Sunwood-ai-labs/Jupytext-Web" target="_blank" class="footer-link">GitHub</a>
      </div>
    </footer>
  </div>

  <!-- Ace Editor CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.32.6/src-min-noconflict/ace.js"></script>

  <!-- Pyodide CDN -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>

  <!-- Notebook Preview Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script type="module">
    import { AnsiUp } from 'https://cdn.jsdelivr.net/npm/ansi_up@6.0.2/ansi_up.min.js';
    window.AnsiUp = AnsiUp;
  </script>

  <!-- External JavaScript -->
  <script src="./script.js"></script>
</body>
</html>
